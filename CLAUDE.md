# 俳句鑑賞＆記録アプリ開発仕様書

## プロジェクト概要

地図上で俳句を視覚的に鑑賞・記録できるWebアプリケーション。句碑やゆかりの地と俳句を関連付け、地図インターフェースを通じて俳句文化を探索できる。

## 基本機能

### 1. 地図上での俳句表示機能
- 地図上に俳句の位置をピンで表示
- ピンをタップすると俳句の詳細情報を表示
  - 詠み人
  - 俳句本文
  - 詠んだ日付
  - 関連する場所情報（句碑、紀行文、ゆかりの地など）

### 2. 俳句の投稿機能
- 新しい俳句の登録
- 位置情報の設定（手動選択または現在地取得）
- 俳句に関連する場所の種別選択（句碑/紀行文/ゆかりの地）
- 詠み人情報の入力または既存詠み人の選択

### 3. 詠み人管理機能
- 詠み人の新規登録
- 既存詠み人情報の編集
- 詠み人別の俳句一覧表示

### 4. CSVを使った一括アップロード機能
- 俳句データのCSV形式での一括インポート
- 詠み人データのCSV形式での一括インポート
- エラーハンドリングとデータ検証

## 地図機能仕様

### 地図表示
- レスポンシブ対応の地図インターフェース
- ズームイン/アウト機能
- 現在地表示機能

### 俳句と場所の関連付け
- **句碑**: 実際に俳句が刻まれた石碑の位置
- **紀行文**: 俳句が詠まれた旅の記録に関連する場所
- **ゆかりの地**: 俳句や詠み人に縁のある土地

### インタラクション
- ピンのクラスター表示（同一地域に複数俳句がある場合）
- フィルタリング機能（時代別、詠み人別、場所種別）
- 検索機能（俳句本文、詠み人名での検索）

## ユーザー体験設計

### アクセス方式
- ユーザー登録不要
- 匿名でのデータ閲覧・投稿が可能

### データの公開性
- オープンなデータベース構造
- すべてのユーザーが俳句の登録・編集可能
- 荒らし対策として編集履歴の保持

### シンプルなUI/UX
- 評価機能なし
- コメント機能なし
- 俳句そのものに集中できるミニマルなデザイン

## 技術仕様

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: レスポンシブデザイン、モバイルファースト
- **JavaScript**: 
  - 地図API連携（Google Maps API または OpenStreetMap）
  - 非同期通信（Fetch API）
  - CSV解析ライブラリ

### バックエンド
- **Google Apps Script (GAS)**
  - RESTful API エンドポイント
  - データ操作ロジック
  - CSV処理機能
  - 認証・認可（編集権限管理）

### データベース構造

#### 1. 俳句データベース（Google Spreadsheet）
| カラム名 | データ型 | 説明 |
|---------|---------|------|
| id | 数値 | 俳句ID（主キー） |
| haiku_text | 文字列 | 俳句本文 |
| poet_id | 数値 | 詠み人ID（外部キー） |
| latitude | 数値 | 緯度 |
| longitude | 数値 | 経度 |
| location_type | 文字列 | 場所種別（句碑/紀行文/ゆかりの地） |
| date_composed | 日付 | 詠んだ日付 |
| location_name | 文字列 | 場所名 |
| description | 文字列 | 説明・備考 |
| created_at | 日時 | 登録日時 |
| updated_at | 日時 | 更新日時 |

#### 2. 詠み人データベース（Google Spreadsheet）
| カラム名 | データ型 | 説明 |
|---------|---------|------|
| id | 数値 | 詠み人ID（主キー） |
| name | 文字列 | 詠み人名 |
| name_kana | 文字列 | 読み仮名 |
| birth_year | 数値 | 生年 |
| death_year | 数値 | 没年 |
| period | 文字列 | 時代区分 |
| biography | 文字列 | 略歴 |
| created_at | 日時 | 登録日時 |
| updated_at | 日時 | 更新日時 |

### API エンドポイント

#### 俳句関連
- `GET /api/haikus` - 俳句一覧取得
- `GET /api/haikus/{id}` - 特定俳句取得
- `POST /api/haikus` - 俳句新規登録
- `PUT /api/haikus/{id}` - 俳句更新
- `DELETE /api/haikus/{id}` - 俳句削除

#### 詠み人関連
- `GET /api/poets` - 詠み人一覧取得
- `GET /api/poets/{id}` - 特定詠み人取得
- `POST /api/poets` - 詠み人新規登録
- `PUT /api/poets/{id}` - 詠み人更新

#### 一括処理
- `POST /api/haikus/bulk` - 俳句CSV一括アップロード
- `POST /api/poets/bulk` - 詠み人CSV一括アップロード

### CSV形式仕様

#### 俳句CSVフォーマット
```csv
haiku_text,poet_name,latitude,longitude,location_type,date_composed,location_name,description
"古池や蛙飛び込む水の音",松尾芭蕉,35.7028,139.7753,ゆかりの地,1686-01-01,深川,芭蕉庵での句
```

#### 詠み人CSVフォーマット
```csv
name,name_kana,birth_year,death_year,period,biography
松尾芭蕉,まつおばしょう,1644,1694,江戸時代前期,俳諧の大成者
```

## 開発フェーズ

### Phase 1: 基盤構築
- データベース設計・構築
- 基本的なGAS API開発
- 地図表示機能の実装

### Phase 2: 核心機能開発
- 俳句表示・投稿機能
- 詠み人管理機能
- 基本的な検索・フィルタ機能

### Phase 3: 機能拡張
- CSV一括アップロード機能
- 高度な検索・フィルタリング
- UI/UX改善

### Phase 4: 最適化・公開準備
- パフォーマンス最適化
- モバイル対応強化
- セキュリティ対策
- 本番環境デプロイ

## 非機能要件

### パフォーマンス
- モバイル環境での快適な動作
- 地図読み込み時間の最適化
- 大量データ表示時のパフォーマンス確保

### セキュリティ
- XSS対策
- CSRF対策
- 入力値検証
- レート制限

### 可用性
- Google Apps Scriptの制限内での運用
- エラーハンドリング
- グレースフルデグラデーション

## 今後の拡張可能性

- 多言語対応
- 俳句の音声読み上げ機能
- 季語・季節での絞り込み機能
- 俳句の画像表示機能
- GPSを活用した位置ベース通知
- 俳句散歩ルート機能

---

*この仕様書は開発の進行に合わせて継続的に更新されます。*