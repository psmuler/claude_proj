# データベースセットアップガイド

## Google スプレッドシートでのデータベース構築手順

### 1. 詠み人データベースの作成

1. **新しいGoogle スプレッドシートを作成**
   - Googleドライブにアクセス
   - 「新規」→「Googleスプレッドシート」を選択
   - シート名を「俳句アプリ - 詠み人DB」に変更

2. **CSVデータのインポート**
   - `poets_sample.csv` の内容をコピー
   - A1セルに貼り付け
   - 「データ」→「テキストを列に分割」を選択
   - 区切り文字として「カンマ」を選択

3. **シート名を「poets」に変更**

### 2. 俳句データベースの作成

1. **新しいシートを追加**
   - シート下部の「+」ボタンをクリック
   - シート名を「haikus」に変更

2. **CSVデータのインポート**
   - `haikus_sample.csv` の内容をコピー
   - A1セルに貼り付け
   - 「データ」→「テキストを列に分割」を選択
   - 区切り文字として「カンマ」を選択

### 3. データ形式の調整

#### 詠み人シート（poets）の列構成
- A列: id（数値）
- B列: name（文字列）
- C列: name_kana（文字列）
- D列: birth_year（数値）
- E列: death_year（数値）
- F列: period（文字列）
- G列: biography（文字列）
- H列: created_at（日時）
- I列: updated_at（日時）

#### 俳句シート（haikus）の列構成
- A列: id（数値）
- B列: haiku_text（文字列）
- C列: poet_id（数値） ※詠み人DBとの外部キー
- D列: latitude（数値、小数点）
- E列: longitude（数値、小数点）
- F列: location_type（文字列：句碑/紀行文/ゆかりの地）
- G列: date_composed（日付）
- H列: location_name（文字列）
- I列: description（文字列）
- J列: created_at（日時）
- K列: updated_at（日時）

### 4. スプレッドシートの共有設定

1. **共有設定**
   - 右上の「共有」ボタンをクリック
   - 「リンクを知っている全員」に設定
   - 権限を「編集者」に設定（Google Apps Scriptからアクセスするため）

2. **スプレッドシートIDの取得**
   - URLから長い英数字の部分をコピー
   - 例：`1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`

### 5. データ整合性の確認

#### 確認すべきポイント
✅ 俳句の `poet_id` が詠み人DBの `id` と対応している
✅ 緯度・経度が正しい数値形式で入力されている
✅ `location_type` が「句碑」「紀行文」「ゆかりの地」のいずれか
✅ 日付が適切な形式（YYYY-MM-DD）で入力されている

#### サンプルデータの関連性
- poet_id: 1 → 松尾芭蕉
- poet_id: 2 → 与謝蕪村
- poet_id: 3 → 小林一茶
- poet_id: 4 → 正岡子規

### 6. Google Apps Script用の準備

1. **スプレッドシートIDをメモ**
2. **シート名を確認**：
   - 詠み人シート: `poets`
   - 俳句シート: `haikus`
3. **列の順序が正しいことを確認**

---

## 次のステップ

このデータベースが完成したら、Google Apps ScriptでAPIエンドポイントを作成し、Webアプリケーションから操作できるようにします。

## トラブルシューティング

### CSVインポート時の問題
- **文字化け**: ファイルをUTF-8で保存し直す
- **列分割の失敗**: 手動で「データ」→「テキストを列に分割」を実行
- **日付形式エラー**: セルの書式を「日付」または「日時」に変更

### データ形式の問題
- **数値が文字列になる**: 該当列を選択し、書式を「数値」に変更
- **空白セルの処理**: Google Apps Scriptで空白チェックを実装予定